{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyTheme = require('../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nvar _AmplifyUI = require('../AmplifyUI');\n\nvar _qrcode = require('qrcode.react');\n\nvar _qrcode2 = _interopRequireDefault(_qrcode);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\n\nvar logger = new _core.ConsoleLogger('TOTPSetupComp');\n\nvar TOTPSetupComp = function (_Component) {\n  (0, _inherits3.default)(TOTPSetupComp, _Component);\n\n  function TOTPSetupComp(props) {\n    (0, _classCallCheck3.default)(this, TOTPSetupComp);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (TOTPSetupComp.__proto__ || Object.getPrototypeOf(TOTPSetupComp)).call(this, props));\n\n    _this.setup = _this.setup.bind(_this);\n    _this.showSecretCode = _this.showSecretCode.bind(_this);\n    _this.verifyTotpToken = _this.verifyTotpToken.bind(_this);\n    _this.handleInputChange = _this.handleInputChange.bind(_this);\n    _this.triggerTOTPEvent = _this.triggerTOTPEvent.bind(_this);\n    _this.state = {\n      code: null,\n      setupMessage: null\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(TOTPSetupComp, [{\n    key: 'triggerTOTPEvent',\n    value: function triggerTOTPEvent(event, data, user) {\n      if (this.props.onTOTPEvent) {\n        this.props.onTOTPEvent(event, data, user);\n      }\n    }\n  }, {\n    key: 'handleInputChange',\n    value: function handleInputChange(evt) {\n      this.setState({\n        setupMessage: null\n      });\n      this.inputs = {};\n      var _evt$target = evt.target,\n          name = _evt$target.name,\n          value = _evt$target.value,\n          type = _evt$target.type,\n          checked = _evt$target.checked;\n      var check_type = ['radio', 'checkbox'].includes(type);\n      this.inputs[name] = check_type ? checked : value;\n    }\n  }, {\n    key: 'setup',\n    value: function setup() {\n      var _this2 = this;\n\n      this.setState({\n        setupMessage: null\n      });\n      var user = this.props.authData;\n\n      if (!_auth2.default || typeof _auth2.default.setupTOTP !== 'function') {\n        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n      }\n\n      _auth2.default.setupTOTP(user).then(function (data) {\n        logger.debug('secret key', data);\n        var code = \"otpauth://totp/AWSCognito:\" + user.username + \"?secret=\" + data + \"&issuer=AWSCognito\";\n\n        _this2.setState({\n          code: code\n        });\n      }).catch(function (err) {\n        return logger.debug('totp setup failed', err);\n      });\n    }\n  }, {\n    key: 'verifyTotpToken',\n    value: function verifyTotpToken() {\n      var _this3 = this;\n\n      if (!this.inputs) {\n        logger.debug('no input');\n        return;\n      }\n\n      var user = this.props.authData;\n      var totpCode = this.inputs.totpCode;\n\n      if (!_auth2.default || typeof _auth2.default.verifyTotpToken !== 'function' || typeof _auth2.default.setPreferredMFA !== 'function') {\n        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n      }\n\n      _auth2.default.verifyTotpToken(user, totpCode).then(function () {\n        // set it to preferred mfa\n        _auth2.default.setPreferredMFA(user, 'TOTP');\n\n        _this3.setState({\n          setupMessage: 'Setup TOTP successfully!'\n        });\n\n        logger.debug('set up totp success!');\n\n        _this3.triggerTOTPEvent('Setup TOTP', 'SUCCESS', user);\n      }).catch(function (err) {\n        _this3.setState({\n          setupMessage: 'Setup TOTP failed!'\n        });\n\n        logger.error(err);\n      });\n    }\n  }, {\n    key: 'showSecretCode',\n    value: function showSecretCode(code, theme) {\n      if (!code) return null;\n      return _react2.default.createElement('div', null, _react2.default.createElement(_qrcode2.default, {\n        value: code\n      }), _react2.default.createElement(_AmplifyUI.InputRow, {\n        autoFocus: true,\n        placeholder: _core.I18n.get('totp verification token'),\n        theme: theme,\n        key: 'totpCode',\n        name: 'totpCode',\n        onChange: this.handleInputChange\n      }), _react2.default.createElement(_AmplifyUI.ButtonRow, {\n        theme: theme,\n        onClick: this.verifyTotpToken\n      }, _core.I18n.get('Verify')));\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var theme = this.props.theme ? this.props.theme : _AmplifyTheme2.default;\n      var code = this.state.code;\n      return _react2.default.createElement(_AmplifyUI.FormSection, {\n        theme: theme\n      }, _react2.default.createElement(_AmplifyUI.SectionHeader, {\n        theme: theme\n      }, _core.I18n.get('TOTP Setup')), _react2.default.createElement(_AmplifyUI.SectionBody, {\n        theme: theme\n      }, _react2.default.createElement(_AmplifyUI.ButtonRow, {\n        theme: theme,\n        onClick: this.setup\n      }, _core.I18n.get('Get secret key')), this.showSecretCode(code, theme), this.state.setupMessage ? _react2.default.createElement(_AmplifyUI.MessageRow, {\n        theme: theme\n      }, _core.I18n.get(this.state.setupMessage)) : null));\n    }\n  }]);\n  return TOTPSetupComp;\n}(_react.Component);\n\nexports.default = TOTPSetupComp;","map":{"version":3,"sources":["/home/ec2-user/environment/amazon-cognito-identity-management-workshop/website/node_modules/aws-amplify-react/dist/Widget/TOTPSetupComp.js"],"names":["Object","defineProperty","exports","value","_classCallCheck2","require","_classCallCheck3","_interopRequireDefault","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_core","_auth","_auth2","_AmplifyTheme","_AmplifyTheme2","_AmplifyUI","_qrcode","_qrcode2","obj","__esModule","default","logger","ConsoleLogger","TOTPSetupComp","_Component","props","_this","__proto__","getPrototypeOf","call","setup","bind","showSecretCode","verifyTotpToken","handleInputChange","triggerTOTPEvent","state","code","setupMessage","key","event","data","user","onTOTPEvent","evt","setState","inputs","_evt$target","target","name","type","checked","check_type","includes","_this2","authData","setupTOTP","Error","then","debug","username","catch","err","_this3","totpCode","setPreferredMFA","error","theme","createElement","InputRow","autoFocus","placeholder","I18n","get","onChange","ButtonRow","onClick","render","FormSection","SectionHeader","SectionBody","MessageRow","Component"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyTheme = require('../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nvar _AmplifyUI = require('../AmplifyUI');\n\nvar _qrcode = require('qrcode.react');\n\nvar _qrcode2 = _interopRequireDefault(_qrcode);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar logger = new _core.ConsoleLogger('TOTPSetupComp');\n\nvar TOTPSetupComp = function (_Component) {\n    (0, _inherits3.default)(TOTPSetupComp, _Component);\n\n    function TOTPSetupComp(props) {\n        (0, _classCallCheck3.default)(this, TOTPSetupComp);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (TOTPSetupComp.__proto__ || Object.getPrototypeOf(TOTPSetupComp)).call(this, props));\n\n        _this.setup = _this.setup.bind(_this);\n        _this.showSecretCode = _this.showSecretCode.bind(_this);\n        _this.verifyTotpToken = _this.verifyTotpToken.bind(_this);\n        _this.handleInputChange = _this.handleInputChange.bind(_this);\n        _this.triggerTOTPEvent = _this.triggerTOTPEvent.bind(_this);\n\n        _this.state = {\n            code: null,\n            setupMessage: null\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(TOTPSetupComp, [{\n        key: 'triggerTOTPEvent',\n        value: function triggerTOTPEvent(event, data, user) {\n            if (this.props.onTOTPEvent) {\n                this.props.onTOTPEvent(event, data, user);\n            }\n        }\n    }, {\n        key: 'handleInputChange',\n        value: function handleInputChange(evt) {\n            this.setState({ setupMessage: null });\n            this.inputs = {};\n            var _evt$target = evt.target,\n                name = _evt$target.name,\n                value = _evt$target.value,\n                type = _evt$target.type,\n                checked = _evt$target.checked;\n\n            var check_type = ['radio', 'checkbox'].includes(type);\n            this.inputs[name] = check_type ? checked : value;\n        }\n    }, {\n        key: 'setup',\n        value: function setup() {\n            var _this2 = this;\n\n            this.setState({ setupMessage: null });\n            var user = this.props.authData;\n            if (!_auth2.default || typeof _auth2.default.setupTOTP !== 'function') {\n                throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n            }\n\n            _auth2.default.setupTOTP(user).then(function (data) {\n                logger.debug('secret key', data);\n                var code = \"otpauth://totp/AWSCognito:\" + user.username + \"?secret=\" + data + \"&issuer=AWSCognito\";\n                _this2.setState({ code: code });\n            }).catch(function (err) {\n                return logger.debug('totp setup failed', err);\n            });\n        }\n    }, {\n        key: 'verifyTotpToken',\n        value: function verifyTotpToken() {\n            var _this3 = this;\n\n            if (!this.inputs) {\n                logger.debug('no input');\n                return;\n            }\n            var user = this.props.authData;\n            var totpCode = this.inputs.totpCode;\n\n            if (!_auth2.default || typeof _auth2.default.verifyTotpToken !== 'function' || typeof _auth2.default.setPreferredMFA !== 'function') {\n                throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n            }\n            _auth2.default.verifyTotpToken(user, totpCode).then(function () {\n                // set it to preferred mfa\n                _auth2.default.setPreferredMFA(user, 'TOTP');\n                _this3.setState({ setupMessage: 'Setup TOTP successfully!' });\n                logger.debug('set up totp success!');\n                _this3.triggerTOTPEvent('Setup TOTP', 'SUCCESS', user);\n            }).catch(function (err) {\n                _this3.setState({ setupMessage: 'Setup TOTP failed!' });\n                logger.error(err);\n            });\n        }\n    }, {\n        key: 'showSecretCode',\n        value: function showSecretCode(code, theme) {\n            if (!code) return null;\n            return _react2.default.createElement(\n                'div',\n                null,\n                _react2.default.createElement(_qrcode2.default, { value: code }),\n                _react2.default.createElement(_AmplifyUI.InputRow, {\n                    autoFocus: true,\n                    placeholder: _core.I18n.get('totp verification token'),\n                    theme: theme,\n                    key: 'totpCode',\n                    name: 'totpCode',\n                    onChange: this.handleInputChange\n                }),\n                _react2.default.createElement(\n                    _AmplifyUI.ButtonRow,\n                    { theme: theme, onClick: this.verifyTotpToken },\n                    _core.I18n.get('Verify')\n                )\n            );\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var theme = this.props.theme ? this.props.theme : _AmplifyTheme2.default;\n            var code = this.state.code;\n\n            return _react2.default.createElement(\n                _AmplifyUI.FormSection,\n                { theme: theme },\n                _react2.default.createElement(\n                    _AmplifyUI.SectionHeader,\n                    { theme: theme },\n                    _core.I18n.get('TOTP Setup')\n                ),\n                _react2.default.createElement(\n                    _AmplifyUI.SectionBody,\n                    { theme: theme },\n                    _react2.default.createElement(\n                        _AmplifyUI.ButtonRow,\n                        { theme: theme, onClick: this.setup },\n                        _core.I18n.get('Get secret key')\n                    ),\n                    this.showSecretCode(code, theme),\n                    this.state.setupMessage ? _react2.default.createElement(\n                        _AmplifyUI.MessageRow,\n                        { theme: theme },\n                        _core.I18n.get(this.state.setupMessage)\n                    ) : null\n                )\n            );\n        }\n    }]);\n    return TOTPSetupComp;\n}(_react.Component);\n\nexports.default = TOTPSetupComp;"]},"metadata":{},"sourceType":"script"}