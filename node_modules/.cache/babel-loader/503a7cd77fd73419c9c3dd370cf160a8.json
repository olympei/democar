{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AuthPiece2 = require('./AuthPiece');\n\nvar _AuthPiece3 = _interopRequireDefault(_AuthPiece2);\n\nvar _AmplifyUI = require('../AmplifyUI');\n\nvar _AmplifyTheme = require('../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\n\nvar logger = new _core.ConsoleLogger('Greetings');\n\nvar Greetings = function (_AuthPiece) {\n  (0, _inherits3.default)(Greetings, _AuthPiece);\n\n  function Greetings(props) {\n    (0, _classCallCheck3.default)(this, Greetings);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Greetings.__proto__ || Object.getPrototypeOf(Greetings)).call(this, props));\n\n    _this.signOut = _this.signOut.bind(_this);\n    _this.googleSignOut = _this.googleSignOut.bind(_this);\n    _this.facebookSignOut = _this.facebookSignOut.bind(_this);\n    _this.checkUser = _this.checkUser.bind(_this);\n    _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n    _this.state = {\n      authState: props.authState,\n      authData: props.authData\n    };\n\n    _core.Hub.listen('auth', _this);\n\n    return _this;\n  }\n\n  (0, _createClass3.default)(Greetings, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n      this.checkUser();\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n  }, {\n    key: 'signOut',\n    value: function signOut() {\n      var _this2 = this;\n\n      this.googleSignOut();\n      this.facebookSignOut();\n\n      if (!_auth2.default || typeof _auth2.default.signOut !== 'function') {\n        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n      }\n\n      _auth2.default.signOut().then(function () {\n        return _this2.changeState('signedOut');\n      }).catch(function (err) {\n        logger.error(err);\n\n        _this2.error(err);\n      });\n    }\n  }, {\n    key: 'googleSignOut',\n    value: function googleSignOut() {\n      var authInstance = window.gapi && window.gapi.auth2 ? window.gapi.auth2.getAuthInstance() : null;\n\n      if (!authInstance) {\n        return Promise.resolve(null);\n      }\n\n      authInstance.then(function (googleAuth) {\n        if (!googleAuth) {\n          logger.debug('google Auth undefined');\n          return Promise.resolve(null);\n        }\n\n        logger.debug('google signing out');\n        return googleAuth.signOut();\n      });\n    }\n  }, {\n    key: 'facebookSignOut',\n    value: function facebookSignOut() {\n      var fb = window.FB;\n\n      if (!fb) {\n        logger.debug('FB sdk undefined');\n        return Promise.resolve(null);\n      }\n\n      fb.getLoginStatus(function (response) {\n        if (response.status === 'connected') {\n          return new Promise(function (res, rej) {\n            logger.debug('facebook signing out');\n            fb.logout(function (response) {\n              res(response);\n            });\n          });\n        } else {\n          return Promise.resolve(null);\n        }\n      });\n    }\n  }, {\n    key: 'checkUser',\n    value: function checkUser() {\n      var _this3 = this;\n\n      var that = this;\n      var authState = this.state.authState;\n\n      if (!_auth2.default || typeof _auth2.default.currentAuthenticatedUser !== 'function') {\n        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n      }\n\n      return _auth2.default.currentAuthenticatedUser().then(function (user) {\n        if (!that._isMounted) {\n          return;\n        }\n\n        if (authState !== 'signedIn') {\n          _this3.setState({\n            authState: 'signedIn',\n            authData: user\n          });\n\n          _this3.changeState('signedIn', user);\n        }\n      }).catch(function (err) {\n        if (!that._isMounted) {\n          return;\n        }\n\n        _this3.signOut();\n      });\n    }\n  }, {\n    key: 'onHubCapsule',\n    value: function onHubCapsule(capsule) {\n      var channel = capsule.channel,\n          payload = capsule.payload,\n          source = capsule.source;\n\n      if (channel === 'auth' && (payload.event === 'configured' || payload.event === 'cognitoHostedUI')) {\n        this.checkUser();\n      }\n    }\n  }, {\n    key: 'inGreeting',\n    value: function inGreeting(name) {\n      return 'Hello ' + name;\n    }\n  }, {\n    key: 'outGreeting',\n    value: function outGreeting() {\n      return '';\n    }\n  }, {\n    key: 'userGreetings',\n    value: function userGreetings(theme) {\n      var user = this.state.authData;\n      var greeting = this.props.inGreeting || this.inGreeting; // get name from attributes first\n\n      var nameFromAttr = user.attributes ? user.attributes.name || (user.attributes.given_name ? user.attributes.given_name + ' ' + user.attributes.family_name : undefined) : undefined;\n      var name = nameFromAttr || user.name || user.username;\n      var message = typeof greeting === 'function' ? greeting(name) : greeting;\n      return _react2.default.createElement('span', null, _react2.default.createElement(_AmplifyUI.NavItem, {\n        theme: theme\n      }, message), _react2.default.createElement(_AmplifyUI.NavButton, {\n        theme: theme,\n        onClick: this.signOut\n      }, _core.I18n.get('Sign Out')));\n    }\n  }, {\n    key: 'noUserGreetings',\n    value: function noUserGreetings(theme) {\n      var greeting = this.props.outGreeting || this.outGreeting;\n      var message = typeof greeting === 'function' ? greeting() : greeting;\n      return message ? _react2.default.createElement(_AmplifyUI.NavItem, {\n        theme: theme\n      }, message) : null;\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var hide = this.props.hide;\n\n      if (hide && hide.includes(Greetings)) {\n        return null;\n      }\n\n      var authState = this.state.authState;\n      var signedIn = authState === 'signedIn';\n      var theme = this.props.theme || _AmplifyTheme2.default;\n      var greeting = signedIn ? this.userGreetings(theme) : this.noUserGreetings(theme);\n\n      if (!greeting) {\n        return null;\n      }\n\n      return _react2.default.createElement(_AmplifyUI.NavBar, {\n        theme: theme\n      }, _react2.default.createElement(_AmplifyUI.Nav, {\n        theme: theme\n      }, _react2.default.createElement(_AmplifyUI.NavRight, {\n        theme: theme\n      }, greeting)));\n    }\n  }]);\n  return Greetings;\n}(_AuthPiece3.default);\n\nexports.default = Greetings;","map":{"version":3,"sources":["/home/ec2-user/environment/amazon-cognito-identity-management-workshop/website/node_modules/aws-amplify-react/dist/Auth/Greetings.js"],"names":["Object","defineProperty","exports","value","_classCallCheck2","require","_classCallCheck3","_interopRequireDefault","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_core","_auth","_auth2","_AuthPiece2","_AuthPiece3","_AmplifyUI","_AmplifyTheme","_AmplifyTheme2","obj","__esModule","default","logger","ConsoleLogger","Greetings","_AuthPiece","props","_this","__proto__","getPrototypeOf","call","signOut","bind","googleSignOut","facebookSignOut","checkUser","onHubCapsule","state","authState","authData","Hub","listen","key","componentDidMount","_isMounted","componentWillUnmount","_this2","Error","then","changeState","catch","err","error","authInstance","window","gapi","auth2","getAuthInstance","Promise","resolve","googleAuth","debug","fb","FB","getLoginStatus","response","status","res","rej","logout","_this3","that","currentAuthenticatedUser","user","setState","capsule","channel","payload","source","event","inGreeting","name","outGreeting","userGreetings","theme","greeting","nameFromAttr","attributes","given_name","family_name","undefined","username","message","createElement","NavItem","NavButton","onClick","I18n","get","noUserGreetings","render","hide","includes","signedIn","NavBar","Nav","NavRight"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AuthPiece2 = require('./AuthPiece');\n\nvar _AuthPiece3 = _interopRequireDefault(_AuthPiece2);\n\nvar _AmplifyUI = require('../AmplifyUI');\n\nvar _AmplifyTheme = require('../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar logger = new _core.ConsoleLogger('Greetings');\n\nvar Greetings = function (_AuthPiece) {\n    (0, _inherits3.default)(Greetings, _AuthPiece);\n\n    function Greetings(props) {\n        (0, _classCallCheck3.default)(this, Greetings);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Greetings.__proto__ || Object.getPrototypeOf(Greetings)).call(this, props));\n\n        _this.signOut = _this.signOut.bind(_this);\n        _this.googleSignOut = _this.googleSignOut.bind(_this);\n        _this.facebookSignOut = _this.facebookSignOut.bind(_this);\n        _this.checkUser = _this.checkUser.bind(_this);\n        _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n\n        _this.state = {\n            authState: props.authState,\n            authData: props.authData\n        };\n\n        _core.Hub.listen('auth', _this);\n        return _this;\n    }\n\n    (0, _createClass3.default)(Greetings, [{\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            this._isMounted = true;\n            this.checkUser();\n        }\n    }, {\n        key: 'componentWillUnmount',\n        value: function componentWillUnmount() {\n            this._isMounted = false;\n        }\n    }, {\n        key: 'signOut',\n        value: function signOut() {\n            var _this2 = this;\n\n            this.googleSignOut();\n            this.facebookSignOut();\n            if (!_auth2.default || typeof _auth2.default.signOut !== 'function') {\n                throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n            }\n            _auth2.default.signOut().then(function () {\n                return _this2.changeState('signedOut');\n            }).catch(function (err) {\n                logger.error(err);_this2.error(err);\n            });\n        }\n    }, {\n        key: 'googleSignOut',\n        value: function googleSignOut() {\n            var authInstance = window.gapi && window.gapi.auth2 ? window.gapi.auth2.getAuthInstance() : null;\n            if (!authInstance) {\n                return Promise.resolve(null);\n            }\n\n            authInstance.then(function (googleAuth) {\n                if (!googleAuth) {\n                    logger.debug('google Auth undefined');\n                    return Promise.resolve(null);\n                }\n\n                logger.debug('google signing out');\n                return googleAuth.signOut();\n            });\n        }\n    }, {\n        key: 'facebookSignOut',\n        value: function facebookSignOut() {\n            var fb = window.FB;\n            if (!fb) {\n                logger.debug('FB sdk undefined');\n                return Promise.resolve(null);\n            }\n\n            fb.getLoginStatus(function (response) {\n                if (response.status === 'connected') {\n                    return new Promise(function (res, rej) {\n                        logger.debug('facebook signing out');\n                        fb.logout(function (response) {\n                            res(response);\n                        });\n                    });\n                } else {\n                    return Promise.resolve(null);\n                }\n            });\n        }\n    }, {\n        key: 'checkUser',\n        value: function checkUser() {\n            var _this3 = this;\n\n            var that = this;\n            var authState = this.state.authState;\n\n            if (!_auth2.default || typeof _auth2.default.currentAuthenticatedUser !== 'function') {\n                throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n            }\n            return _auth2.default.currentAuthenticatedUser().then(function (user) {\n                if (!that._isMounted) {\n                    return;\n                }\n                if (authState !== 'signedIn') {\n                    _this3.setState({\n                        authState: 'signedIn',\n                        authData: user\n                    });\n                    _this3.changeState('signedIn', user);\n                }\n            }).catch(function (err) {\n                if (!that._isMounted) {\n                    return;\n                }\n                _this3.signOut();\n            });\n        }\n    }, {\n        key: 'onHubCapsule',\n        value: function onHubCapsule(capsule) {\n            var channel = capsule.channel,\n                payload = capsule.payload,\n                source = capsule.source;\n\n            if (channel === 'auth' && (payload.event === 'configured' || payload.event === 'cognitoHostedUI')) {\n                this.checkUser();\n            }\n        }\n    }, {\n        key: 'inGreeting',\n        value: function inGreeting(name) {\n            return 'Hello ' + name;\n        }\n    }, {\n        key: 'outGreeting',\n        value: function outGreeting() {\n            return '';\n        }\n    }, {\n        key: 'userGreetings',\n        value: function userGreetings(theme) {\n            var user = this.state.authData;\n            var greeting = this.props.inGreeting || this.inGreeting;\n            // get name from attributes first\n            var nameFromAttr = user.attributes ? user.attributes.name || (user.attributes.given_name ? user.attributes.given_name + ' ' + user.attributes.family_name : undefined) : undefined;\n\n            var name = nameFromAttr || user.name || user.username;\n            var message = typeof greeting === 'function' ? greeting(name) : greeting;\n            return _react2.default.createElement(\n                'span',\n                null,\n                _react2.default.createElement(\n                    _AmplifyUI.NavItem,\n                    { theme: theme },\n                    message\n                ),\n                _react2.default.createElement(\n                    _AmplifyUI.NavButton,\n                    {\n                        theme: theme,\n                        onClick: this.signOut\n                    },\n                    _core.I18n.get('Sign Out')\n                )\n            );\n        }\n    }, {\n        key: 'noUserGreetings',\n        value: function noUserGreetings(theme) {\n            var greeting = this.props.outGreeting || this.outGreeting;\n            var message = typeof greeting === 'function' ? greeting() : greeting;\n            return message ? _react2.default.createElement(\n                _AmplifyUI.NavItem,\n                { theme: theme },\n                message\n            ) : null;\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var hide = this.props.hide;\n\n            if (hide && hide.includes(Greetings)) {\n                return null;\n            }\n\n            var authState = this.state.authState;\n\n            var signedIn = authState === 'signedIn';\n\n            var theme = this.props.theme || _AmplifyTheme2.default;\n            var greeting = signedIn ? this.userGreetings(theme) : this.noUserGreetings(theme);\n            if (!greeting) {\n                return null;\n            }\n\n            return _react2.default.createElement(\n                _AmplifyUI.NavBar,\n                { theme: theme },\n                _react2.default.createElement(\n                    _AmplifyUI.Nav,\n                    { theme: theme },\n                    _react2.default.createElement(\n                        _AmplifyUI.NavRight,\n                        { theme: theme },\n                        greeting\n                    )\n                )\n            );\n        }\n    }]);\n    return Greetings;\n}(_AuthPiece3.default);\n\nexports.default = Greetings;"]},"metadata":{},"sourceType":"script"}