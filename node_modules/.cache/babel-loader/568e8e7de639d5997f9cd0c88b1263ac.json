{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AmazonButton = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nexports.default = withAmazon;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyTheme = require('../../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nvar _AmplifyUI = require('../../AmplifyUI');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar logger = new _core.ConsoleLogger('withAmazon');\n\nfunction withAmazon(Comp) {\n  return function (_Component) {\n    (0, _inherits3.default)(_class, _Component);\n\n    function _class(props) {\n      (0, _classCallCheck3.default)(this, _class);\n\n      var _this = (0, _possibleConstructorReturn3.default)(this, (_class.__proto__ || Object.getPrototypeOf(_class)).call(this, props));\n\n      _this.initAmazon = _this.initAmazon.bind(_this);\n      _this.signIn = _this.signIn.bind(_this);\n      _this.federatedSignIn = _this.federatedSignIn.bind(_this);\n      _this.state = {};\n      return _this;\n    }\n\n    (0, _createClass3.default)(_class, [{\n      key: 'signIn',\n      value: function signIn() {\n        var _this2 = this;\n\n        var amz = window.amazon;\n        var options = {\n          scope: 'profile'\n        };\n        amz.Login.authorize(options, function (response) {\n          if (response.error) {\n            logger.debug('Failed to login with amazon: ' + response.error);\n            return;\n          }\n\n          _this2.federatedSignIn(response);\n        });\n      }\n    }, {\n      key: 'federatedSignIn',\n      value: function federatedSignIn(response) {\n        var access_token = response.access_token,\n            expires_in = response.expires_in;\n        var onStateChange = this.props.onStateChange;\n        var date = new Date();\n        var expires_at = expires_in * 1000 + date.getTime();\n\n        if (!access_token) {\n          return;\n        }\n\n        var amz = window.amazon;\n        amz.Login.retrieveProfile(function (userInfo) {\n          if (!userInfo.success) {\n            logger.debug('Get user Info failed');\n            return;\n          }\n\n          var user = {\n            name: userInfo.profile.Name\n          };\n\n          if (!_auth2.default || typeof _auth2.default.federatedSignIn !== 'function' || typeof _auth2.default.currentAuthenticatedUser !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n          }\n\n          _auth2.default.federatedSignIn('amazon', {\n            token: access_token,\n            expires_at: expires_at\n          }, user).then(function (credentials) {\n            return _auth2.default.currentAuthenticatedUser();\n          }).then(function (authUser) {\n            if (onStateChange) {\n              onStateChange('signedIn', authUser);\n            }\n          });\n        });\n      }\n    }, {\n      key: 'componentDidMount',\n      value: function componentDidMount() {\n        var amazon_client_id = this.props.amazon_client_id;\n        if (amazon_client_id) this.createScript();\n      }\n    }, {\n      key: 'createScript',\n      value: function createScript() {\n        var script = document.createElement('script');\n        script.src = 'https://api-cdn.amazon.com/sdk/login1.js';\n        script.async = true;\n        script.onload = this.initAmazon;\n        document.body.appendChild(script);\n      }\n    }, {\n      key: 'initAmazon',\n      value: function initAmazon() {\n        logger.debug('init amazon');\n        var amazon_client_id = this.props.amazon_client_id;\n        var amz = window.amazon;\n        amz.Login.setClientId(amazon_client_id);\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        var amz = window.amazon;\n        return _react2.default.createElement(Comp, (0, _extends3.default)({}, this.props, {\n          amz: amz,\n          amazonSignIn: this.signIn\n        }));\n      }\n    }]);\n    return _class;\n  }(_react.Component);\n}\n\nvar Button = function Button(props) {\n  return _react2.default.createElement(_AmplifyUI.SignInButton, {\n    id: 'amazon_signin_btn',\n    onClick: props.amazonSignIn,\n    theme: props.theme || _AmplifyTheme2.default\n  }, 'Sign In with Amazon');\n};\n\nvar AmazonButton = exports.AmazonButton = withAmazon(Button);","map":{"version":3,"sources":["/home/ec2-user/environment/amazon-cognito-identity-management-workshop/website/node_modules/aws-amplify-react/dist/Auth/Provider/withAmazon.js"],"names":["Object","defineProperty","exports","value","AmazonButton","undefined","_extends2","require","_extends3","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","default","withAmazon","_react","_react2","_core","_auth","_auth2","_AmplifyTheme","_AmplifyTheme2","_AmplifyUI","obj","__esModule","logger","ConsoleLogger","Comp","_Component","_class","props","_this","__proto__","getPrototypeOf","call","initAmazon","bind","signIn","federatedSignIn","state","key","_this2","amz","window","amazon","options","scope","Login","authorize","response","error","debug","access_token","expires_in","onStateChange","date","Date","expires_at","getTime","retrieveProfile","userInfo","success","user","name","profile","Name","currentAuthenticatedUser","Error","token","then","credentials","authUser","componentDidMount","amazon_client_id","createScript","script","document","createElement","src","async","onload","body","appendChild","setClientId","render","amazonSignIn","Component","Button","SignInButton","id","onClick","theme"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.AmazonButton = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nexports.default = withAmazon;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyTheme = require('../../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nvar _AmplifyUI = require('../../AmplifyUI');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _core.ConsoleLogger('withAmazon');\n\nfunction withAmazon(Comp) {\n    return function (_Component) {\n        (0, _inherits3.default)(_class, _Component);\n\n        function _class(props) {\n            (0, _classCallCheck3.default)(this, _class);\n\n            var _this = (0, _possibleConstructorReturn3.default)(this, (_class.__proto__ || Object.getPrototypeOf(_class)).call(this, props));\n\n            _this.initAmazon = _this.initAmazon.bind(_this);\n            _this.signIn = _this.signIn.bind(_this);\n            _this.federatedSignIn = _this.federatedSignIn.bind(_this);\n\n            _this.state = {};\n            return _this;\n        }\n\n        (0, _createClass3.default)(_class, [{\n            key: 'signIn',\n            value: function signIn() {\n                var _this2 = this;\n\n                var amz = window.amazon;\n                var options = { scope: 'profile' };\n                amz.Login.authorize(options, function (response) {\n                    if (response.error) {\n                        logger.debug('Failed to login with amazon: ' + response.error);\n                        return;\n                    }\n\n                    _this2.federatedSignIn(response);\n                });\n            }\n        }, {\n            key: 'federatedSignIn',\n            value: function federatedSignIn(response) {\n                var access_token = response.access_token,\n                    expires_in = response.expires_in;\n                var onStateChange = this.props.onStateChange;\n\n                var date = new Date();\n                var expires_at = expires_in * 1000 + date.getTime();\n                if (!access_token) {\n                    return;\n                }\n\n                var amz = window.amazon;\n                amz.Login.retrieveProfile(function (userInfo) {\n                    if (!userInfo.success) {\n                        logger.debug('Get user Info failed');\n                        return;\n                    }\n\n                    var user = {\n                        name: userInfo.profile.Name\n                    };\n                    if (!_auth2.default || typeof _auth2.default.federatedSignIn !== 'function' || typeof _auth2.default.currentAuthenticatedUser !== 'function') {\n                        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n                    }\n\n                    _auth2.default.federatedSignIn('amazon', { token: access_token, expires_at: expires_at }, user).then(function (credentials) {\n                        return _auth2.default.currentAuthenticatedUser();\n                    }).then(function (authUser) {\n                        if (onStateChange) {\n                            onStateChange('signedIn', authUser);\n                        }\n                    });\n                });\n            }\n        }, {\n            key: 'componentDidMount',\n            value: function componentDidMount() {\n                var amazon_client_id = this.props.amazon_client_id;\n\n                if (amazon_client_id) this.createScript();\n            }\n        }, {\n            key: 'createScript',\n            value: function createScript() {\n                var script = document.createElement('script');\n                script.src = 'https://api-cdn.amazon.com/sdk/login1.js';\n                script.async = true;\n                script.onload = this.initAmazon;\n                document.body.appendChild(script);\n            }\n        }, {\n            key: 'initAmazon',\n            value: function initAmazon() {\n                logger.debug('init amazon');\n                var amazon_client_id = this.props.amazon_client_id;\n\n                var amz = window.amazon;\n                amz.Login.setClientId(amazon_client_id);\n            }\n        }, {\n            key: 'render',\n            value: function render() {\n                var amz = window.amazon;\n                return _react2.default.createElement(Comp, (0, _extends3.default)({}, this.props, { amz: amz, amazonSignIn: this.signIn }));\n            }\n        }]);\n        return _class;\n    }(_react.Component);\n}\n\nvar Button = function Button(props) {\n    return _react2.default.createElement(\n        _AmplifyUI.SignInButton,\n        {\n            id: 'amazon_signin_btn',\n            onClick: props.amazonSignIn,\n            theme: props.theme || _AmplifyTheme2.default\n        },\n        'Sign In with Amazon'\n    );\n};\n\nvar AmazonButton = exports.AmazonButton = withAmazon(Button);"]},"metadata":{},"sourceType":"script"}