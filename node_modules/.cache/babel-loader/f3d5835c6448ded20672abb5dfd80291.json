{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _storage = require('@aws-amplify/storage');\n\nvar _storage2 = _interopRequireDefault(_storage);\n\nvar _AmplifyTheme = require('../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nvar _AmplifyUI = require('../AmplifyUI');\n\nvar _Widget = require('../Widget');\n\nvar _Common = require('./Common');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar logger = new _core.ConsoleLogger('Storage.S3Image');\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar S3Image = function (_Component) {\n  (0, _inherits3.default)(S3Image, _Component);\n\n  function S3Image(props) {\n    (0, _classCallCheck3.default)(this, S3Image);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (S3Image.__proto__ || Object.getPrototypeOf(S3Image)).call(this, props));\n\n    _this.handleOnLoad = _this.handleOnLoad.bind(_this);\n    _this.handleOnError = _this.handleOnError.bind(_this);\n    _this.handlePick = _this.handlePick.bind(_this);\n    _this.handleClick = _this.handleClick.bind(_this);\n    var initSrc = _this.props.src || _AmplifyUI.transparent1X1;\n    _this.state = {\n      src: initSrc\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(S3Image, [{\n    key: 'getImageSource',\n    value: function getImageSource(key, level, track) {\n      var _this2 = this;\n\n      if (!_storage2.default || typeof _storage2.default.get !== 'function') {\n        throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n      }\n\n      _storage2.default.get(key, {\n        level: level ? level : 'public',\n        track: track\n      }).then(function (url) {\n        _this2.setState({\n          src: url\n        });\n      }).catch(function (err) {\n        return logger.debug(err);\n      });\n    }\n  }, {\n    key: 'load',\n    value: function load() {\n      var _props = this.props,\n          imgKey = _props.imgKey,\n          path = _props.path,\n          body = _props.body,\n          contentType = _props.contentType,\n          level = _props.level,\n          track = _props.track;\n\n      if (!imgKey && !path) {\n        logger.debug('empty imgKey and path');\n        return;\n      }\n\n      var that = this;\n      var key = imgKey || path;\n      logger.debug('loading ' + key + '...');\n\n      if (body) {\n        var type = contentType || 'binary/octet-stream';\n\n        if (!_storage2.default || typeof _storage2.default.put !== 'function') {\n          throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n        }\n\n        var ret = _storage2.default.put(key, body, {\n          contentType: type,\n          level: level ? level : 'public',\n          track: track\n        });\n\n        ret.then(function (data) {\n          logger.debug(data);\n          that.getImageSource(key, level, track);\n        }).catch(function (err) {\n          return logger.debug(err);\n        });\n      } else {\n        that.getImageSource(key, level, track);\n      }\n    }\n  }, {\n    key: 'handleOnLoad',\n    value: function handleOnLoad(evt) {\n      var onLoad = this.props.onLoad;\n\n      if (onLoad) {\n        onLoad(this.state.src);\n      }\n    }\n  }, {\n    key: 'handleOnError',\n    value: function handleOnError(evt) {\n      var onError = this.props.onError;\n\n      if (onError) {\n        onError(this.state.src);\n      }\n    }\n  }, {\n    key: 'handlePick',\n    value: function handlePick(data) {\n      var that = this;\n      var path = this.props.path || '';\n      var _props2 = this.props,\n          imgKey = _props2.imgKey,\n          level = _props2.level,\n          fileToKey = _props2.fileToKey,\n          track = _props2.track;\n      var file = data.file,\n          name = data.name,\n          size = data.size,\n          type = data.type;\n      var key = imgKey || path + (0, _Common.calcKey)(data, fileToKey);\n\n      if (!_storage2.default || typeof _storage2.default.put !== 'function') {\n        throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n      }\n\n      _storage2.default.put(key, file, {\n        level: level ? level : 'public',\n        contentType: type,\n        track: track\n      }).then(function (data) {\n        logger.debug('handle pick data', data);\n        that.getImageSource(key, level, track);\n      }).catch(function (err) {\n        return logger.debug('handle pick error', err);\n      });\n    }\n  }, {\n    key: 'handleClick',\n    value: function handleClick(evt) {\n      var onClick = this.props.onClick;\n\n      if (onClick) {\n        onClick(evt);\n      }\n    }\n  }, {\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.load();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(prevProps) {\n      var update = prevProps.path !== this.props.path || prevProps.imgKey !== this.props.imgKey || prevProps.body !== this.props.body;\n\n      if (update) {\n        this.load();\n      }\n    }\n  }, {\n    key: 'imageEl',\n    value: function imageEl(src, theme) {\n      if (!src) {\n        return null;\n      }\n\n      var selected = this.props.selected;\n      var containerStyle = {\n        position: 'relative'\n      };\n      return _react2.default.createElement('div', {\n        style: containerStyle,\n        onClick: this.handleClick\n      }, _react2.default.createElement('img', {\n        style: theme.photoImg,\n        src: src,\n        onLoad: this.handleOnLoad,\n        onError: this.handleOnError\n      }), _react2.default.createElement('div', {\n        style: selected ? theme.overlaySelected : theme.overlay\n      }));\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props3 = this.props,\n          hidden = _props3.hidden,\n          style = _props3.style,\n          picker = _props3.picker,\n          translate = _props3.translate,\n          imgKey = _props3.imgKey;\n      var src = this.state.src;\n\n      if (translate) {\n        src = typeof translate === 'string' ? translate : translate({\n          type: 'image',\n          key: imgKey,\n          content: src\n        });\n      }\n\n      if (!src && !picker) {\n        return null;\n      }\n\n      var theme = this.props.theme || _AmplifyTheme2.default;\n      var photoStyle = hidden ? _AmplifyTheme2.default.hidden : Object.assign({}, theme.photo, style);\n      return _react2.default.createElement('div', {\n        style: photoStyle\n      }, photoStyle ? this.imageEl(src, theme) : null, picker ? _react2.default.createElement('div', null, _react2.default.createElement(_Widget.PhotoPicker, {\n        key: 'picker',\n        onPick: this.handlePick,\n        theme: theme\n      })) : null);\n    }\n  }]);\n  return S3Image;\n}(_react.Component);\n\nexports.default = S3Image;","map":{"version":3,"sources":["/home/ec2-user/environment/amazon-cognito-identity-management-workshop/website/node_modules/aws-amplify-react/dist/Storage/S3Image.js"],"names":["Object","defineProperty","exports","value","_classCallCheck2","require","_classCallCheck3","_interopRequireDefault","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_core","_storage","_storage2","_AmplifyTheme","_AmplifyTheme2","_AmplifyUI","_Widget","_Common","obj","__esModule","default","logger","ConsoleLogger","S3Image","_Component","props","_this","__proto__","getPrototypeOf","call","handleOnLoad","bind","handleOnError","handlePick","handleClick","initSrc","src","transparent1X1","state","key","getImageSource","level","track","_this2","get","Error","then","url","setState","catch","err","debug","load","_props","imgKey","path","body","contentType","that","type","put","ret","data","evt","onLoad","onError","_props2","fileToKey","file","name","size","calcKey","onClick","componentDidMount","componentDidUpdate","prevProps","update","imageEl","theme","selected","containerStyle","position","createElement","style","photoImg","overlaySelected","overlay","render","_props3","hidden","picker","translate","content","photoStyle","assign","photo","PhotoPicker","onPick","Component"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _storage = require('@aws-amplify/storage');\n\nvar _storage2 = _interopRequireDefault(_storage);\n\nvar _AmplifyTheme = require('../AmplifyTheme');\n\nvar _AmplifyTheme2 = _interopRequireDefault(_AmplifyTheme);\n\nvar _AmplifyUI = require('../AmplifyUI');\n\nvar _Widget = require('../Widget');\n\nvar _Common = require('./Common');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logger = new _core.ConsoleLogger('Storage.S3Image'); /*\n                                                          * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n                                                          *\n                                                          * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n                                                          * the License. A copy of the License is located at\n                                                          *\n                                                          *     http://aws.amazon.com/apache2.0/\n                                                          *\n                                                          * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n                                                          * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n                                                          * and limitations under the License.\n                                                          */\n\nvar S3Image = function (_Component) {\n    (0, _inherits3.default)(S3Image, _Component);\n\n    function S3Image(props) {\n        (0, _classCallCheck3.default)(this, S3Image);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (S3Image.__proto__ || Object.getPrototypeOf(S3Image)).call(this, props));\n\n        _this.handleOnLoad = _this.handleOnLoad.bind(_this);\n        _this.handleOnError = _this.handleOnError.bind(_this);\n        _this.handlePick = _this.handlePick.bind(_this);\n        _this.handleClick = _this.handleClick.bind(_this);\n\n        var initSrc = _this.props.src || _AmplifyUI.transparent1X1;\n\n        _this.state = { src: initSrc };\n        return _this;\n    }\n\n    (0, _createClass3.default)(S3Image, [{\n        key: 'getImageSource',\n        value: function getImageSource(key, level, track) {\n            var _this2 = this;\n\n            if (!_storage2.default || typeof _storage2.default.get !== 'function') {\n                throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n            }\n            _storage2.default.get(key, { level: level ? level : 'public', track: track }).then(function (url) {\n                _this2.setState({\n                    src: url\n                });\n            }).catch(function (err) {\n                return logger.debug(err);\n            });\n        }\n    }, {\n        key: 'load',\n        value: function load() {\n            var _props = this.props,\n                imgKey = _props.imgKey,\n                path = _props.path,\n                body = _props.body,\n                contentType = _props.contentType,\n                level = _props.level,\n                track = _props.track;\n\n            if (!imgKey && !path) {\n                logger.debug('empty imgKey and path');\n                return;\n            }\n\n            var that = this;\n            var key = imgKey || path;\n            logger.debug('loading ' + key + '...');\n            if (body) {\n                var type = contentType || 'binary/octet-stream';\n                if (!_storage2.default || typeof _storage2.default.put !== 'function') {\n                    throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n                }\n                var ret = _storage2.default.put(key, body, {\n                    contentType: type,\n                    level: level ? level : 'public',\n                    track: track\n                });\n                ret.then(function (data) {\n                    logger.debug(data);\n                    that.getImageSource(key, level, track);\n                }).catch(function (err) {\n                    return logger.debug(err);\n                });\n            } else {\n                that.getImageSource(key, level, track);\n            }\n        }\n    }, {\n        key: 'handleOnLoad',\n        value: function handleOnLoad(evt) {\n            var onLoad = this.props.onLoad;\n\n            if (onLoad) {\n                onLoad(this.state.src);\n            }\n        }\n    }, {\n        key: 'handleOnError',\n        value: function handleOnError(evt) {\n            var onError = this.props.onError;\n\n            if (onError) {\n                onError(this.state.src);\n            }\n        }\n    }, {\n        key: 'handlePick',\n        value: function handlePick(data) {\n            var that = this;\n\n            var path = this.props.path || '';\n            var _props2 = this.props,\n                imgKey = _props2.imgKey,\n                level = _props2.level,\n                fileToKey = _props2.fileToKey,\n                track = _props2.track;\n            var file = data.file,\n                name = data.name,\n                size = data.size,\n                type = data.type;\n\n            var key = imgKey || path + (0, _Common.calcKey)(data, fileToKey);\n            if (!_storage2.default || typeof _storage2.default.put !== 'function') {\n                throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n            }\n            _storage2.default.put(key, file, {\n                level: level ? level : 'public',\n                contentType: type,\n                track: track\n            }).then(function (data) {\n                logger.debug('handle pick data', data);\n                that.getImageSource(key, level, track);\n            }).catch(function (err) {\n                return logger.debug('handle pick error', err);\n            });\n        }\n    }, {\n        key: 'handleClick',\n        value: function handleClick(evt) {\n            var onClick = this.props.onClick;\n\n            if (onClick) {\n                onClick(evt);\n            }\n        }\n    }, {\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            this.load();\n        }\n    }, {\n        key: 'componentDidUpdate',\n        value: function componentDidUpdate(prevProps) {\n            var update = prevProps.path !== this.props.path || prevProps.imgKey !== this.props.imgKey || prevProps.body !== this.props.body;\n            if (update) {\n                this.load();\n            }\n        }\n    }, {\n        key: 'imageEl',\n        value: function imageEl(src, theme) {\n            if (!src) {\n                return null;\n            }\n\n            var selected = this.props.selected;\n\n            var containerStyle = { position: 'relative' };\n            return _react2.default.createElement(\n                'div',\n                { style: containerStyle, onClick: this.handleClick },\n                _react2.default.createElement('img', {\n                    style: theme.photoImg,\n                    src: src,\n                    onLoad: this.handleOnLoad,\n                    onError: this.handleOnError\n                }),\n                _react2.default.createElement('div', { style: selected ? theme.overlaySelected : theme.overlay })\n            );\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _props3 = this.props,\n                hidden = _props3.hidden,\n                style = _props3.style,\n                picker = _props3.picker,\n                translate = _props3.translate,\n                imgKey = _props3.imgKey;\n\n            var src = this.state.src;\n            if (translate) {\n                src = typeof translate === 'string' ? translate : translate({\n                    type: 'image',\n                    key: imgKey,\n                    content: src\n                });\n            }\n            if (!src && !picker) {\n                return null;\n            }\n\n            var theme = this.props.theme || _AmplifyTheme2.default;\n            var photoStyle = hidden ? _AmplifyTheme2.default.hidden : Object.assign({}, theme.photo, style);\n\n            return _react2.default.createElement(\n                'div',\n                { style: photoStyle },\n                photoStyle ? this.imageEl(src, theme) : null,\n                picker ? _react2.default.createElement(\n                    'div',\n                    null,\n                    _react2.default.createElement(_Widget.PhotoPicker, {\n                        key: 'picker',\n                        onPick: this.handlePick,\n                        theme: theme\n                    })\n                ) : null\n            );\n        }\n    }]);\n    return S3Image;\n}(_react.Component);\n\nexports.default = S3Image;"]},"metadata":{},"sourceType":"script"}